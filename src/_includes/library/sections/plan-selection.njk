<!-- prettier-ignore -->
{% set title = plan_selection.title | default('No title') %}
{% set desc = plan_selection.desc | default('No description "desc" added currently.') %}
{% set price_toggle = plan_selection.price_toggle or false %}
{% set discount_percentage = plan_selection.discount_percentage or '20%' %}

<!-- prettier-ignore -->
{% set plans = plan_selection.plans %}

<section class="plan-selection">
  <div class="plan-selection__inner">
    <h2 class="plan-selection__title">{{ title }}</h2>
    <p class="plan-selection__desc">{{ desc }}</p>

    {% if price_toggle %}
    <div class="plan-selection__toggle-wrapper watch-scroll" data-scroll-when="near-top">
      <div class="plan-selection__toggle toggle-slider toggle-slider--solid">
        <button
          class="plan-selection__toggle-option"
          data-toggle-option="start"
          aria-selected="true"
        >
          Monthly
        </button>
        <button class="plan-selection__toggle-option" data-toggle-option="end">Quarterly</button>
        <div class="plan-selection__toggle-slider"></div>
      </div>
      <!-- prettier-ignore -->
      {% set tooltip = ({
        message: 'Save '~discount_percentage~' with quarterly billing!',
        size: 'xs',
        place: 'right',
        place_sm: 'bottom-left',
        include_point: true
      }) %}
      {% include "../components/tooltip.njk" %}
    </div>
    {% endif %}

    <div class="plan-options gsap-stagger" data-stagger-delay="0.125">
      <!-- prettier-ignore -->
      {% for plan in plans %}  
      {% set theme = '' %}
      {% if plan.theme %}
        {% set theme = 'plan-option--'~plan.theme~'' %}
      {% endif %}
      <div class="plan-option {{ theme }} gsap-stagger-child">
        <h3 class="plan-option__title h2">{{ plan.title }}</h3>

        <div class="plan-option__price-group">
          <div class="plan-option__line-group" aria-hidden="true">
            <hr class="plan-option__divider" aria-hidden="true" />
            <div class="plan-option__price">
              <span class="plan-option__price-currency">$</span>
              <span
                class="plan-option__price-cost glitch-text"
                data-toggle-target
                data-toggle-end="{{ plan.price_qt }}"
              >
                {{ plan.price_mo }}
              </span>
              <span class="plan-option__price-frequency">/month</span>
            </div>
            <hr class="plan-option__divider" aria-hidden="true" />
          </div>

          <p class="plan-option__total glitch-text" data-toggle-show="end">
            <span>$</span>
            <span
              class="plan-option__total-swap"
              data-toggle-target
              data-toggle-end="{{ plan.grand_total }}"
              >{{ plan.price_mo }}</span
            >
            <span class="glitch-text">billed</span>
            <span
              class="plan-option__total-frequency glitch-text"
              data-toggle-target
              data-toggle-end="quarterly"
            >
              monthly
            </span>
          </p>
        </div>

        <ul class="plan-option__perks">
          {% for perk in plan.features %}
          <li>
            <!-- prettier-ignore -->
            {% set icon_svg = ({
              src: '/static/img/library/icon-google-check-circle.svg', 
              class: '' 
            }) %}
            {% include "../../components/icon-svg.njk" %}
            <span>{{ perk }}</span>
          </li>
          {% endfor %}
        </ul>

        <p
          class="plan-option__message glitch-text"
          data-toggle-target
          data-toggle-end="Youâ€™re saving {{ plan.savings_qt }} quarterly!"
        >
          Save {{ discount_percentage }} with quarterly billing!
        </p>

        <div class="plan-option__cta-wrapper plan-option__cta-wrapper--monthly">
          <!-- prettier-ignore -->
          {% set btn = ({
            text: plan.cta_monthly.text,
            icon_end: '/static/img/library/icon-google-new-tab.svg',
            url: plan.cta_monthly.url,
            type: 'solid',
            class: 'btn--split-text',
            attributes: 'data-hover-alt'
          }) %}
          {% include "../../components/btn.njk" %}
        </div>

        <div class="plan-option__cta-wrapper plan-option__cta-wrapper--quarterly">
          <!-- prettier-ignore -->
          {% set btn = ({
            text: plan.cta_quarterly.text,
            icon_end: '/static/img/library/icon-google-new-tab.svg',
            url: plan.cta_quarterly.url,
            type: 'solid',
            class: 'btn--split-text',
            attributes: 'data-hover-alt'
          }) %}
          {% include "../../components/btn.njk" %}
        </div>

        <!-- prettier-ignore -->
        {% if plan.noise %}
        {% set noise = ({
          id: plan.noise.id,
          color: plan.noise.color
        }) %}
        {% include "../components/noise.njk" %}
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>
</section>
